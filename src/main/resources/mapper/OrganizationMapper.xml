<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.skylark.permission.authorization.mapper.OrganizationMapper">

    <resultMap id="BaseResultMap" type="cn.skylark.permission.authorization.entity.SysOrganization">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="code" property="code" jdbcType="VARCHAR"/>
        <result column="parent_id" property="parentId" jdbcType="BIGINT"/>
        <result column="type" property="type" jdbcType="VARCHAR"/>
        <result column="level" property="level" jdbcType="INTEGER"/>
        <result column="sort" property="sort" jdbcType="INTEGER"/>
        <result column="leader" property="leader" jdbcType="VARCHAR"/>
        <result column="phone" property="phone" jdbcType="VARCHAR"/>
        <result column="email" property="email" jdbcType="VARCHAR"/>
        <result column="address" property="address" jdbcType="VARCHAR"/>
        <result column="description" property="description" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="VARCHAR"/>
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, name, code, parent_id, type, level, sort, leader, phone, email, address,
        description, status, create_time, update_time
    </sql>

    <select id="selectById" parameterType="long" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_organization
        WHERE id = #{id}
    </select>

    <select id="selectByCode" parameterType="string" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_organization
        WHERE code = #{code}
    </select>

    <select id="selectAll" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_organization
        ORDER BY create_time DESC
    </select>

    <select id="selectPage" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_organization
        ORDER BY create_time DESC
        LIMIT #{offset}, #{limit}
    </select>

    <select id="selectPageWithCondition" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_organization
        <where>
            <if test="name != null and name != ''">
                AND name LIKE CONCAT('%', #{name}, '%')
            </if>
            <if test="code != null and code != ''">
                AND code LIKE CONCAT('%', #{code}, '%')
            </if>
            <if test="phone != null and phone != ''">
                AND phone LIKE CONCAT('%', #{phone}, '%')
            </if>
            <if test="email != null and email != ''">
                AND email LIKE CONCAT('%', #{email}, '%')
            </if>
            <if test="type != null and type != ''">
                AND type = #{type}
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
            <if test="createTime != null">
                AND create_time &lt;= #{createTime}
            </if>
        </where>
        ORDER BY create_time DESC
        LIMIT #{offset}, #{limit}
    </select>

    <select id="countAll" resultType="long">
        SELECT COUNT(*)
        FROM sys_organization
    </select>

    <select id="countWithCondition" resultType="long">
        SELECT COUNT(*)
        FROM sys_organization
        <where>
            <if test="name != null and name != ''">
                AND name LIKE CONCAT('%', #{name}, '%')
            </if>
            <if test="code != null and code != ''">
                AND code LIKE CONCAT('%', #{code}, '%')
            </if>
            <if test="phone != null and phone != ''">
                AND phone LIKE CONCAT('%', #{phone}, '%')
            </if>
            <if test="email != null and email != ''">
                AND email LIKE CONCAT('%', #{email}, '%')
            </if>
            <if test="type != null and type != ''">
                AND type = #{type}
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
            <if test="createTime != null">
                AND create_time &lt;= #{createTime}
            </if>
        </where>
    </select>

    <insert id="insert" parameterType="cn.skylark.permission.authorization.entity.SysOrganization" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO sys_organization(
            name, code, parent_id, type, level, sort, leader, phone, email, address,
            description, status
        )
        VALUES (
            #{name}, #{code}, #{parentId}, #{type}, #{level}, #{sort}, #{leader},
            #{phone}, #{email}, #{address}, #{description}, #{status}
        )
    </insert>

    <update id="update" parameterType="cn.skylark.permission.authorization.entity.SysOrganization">
        UPDATE sys_organization
        SET name = #{name},
            code = #{code},
            parent_id = #{parentId},
            type = #{type},
            level = #{level},
            sort = #{sort},
            leader = #{leader},
            phone = #{phone},
            email = #{email},
            address = #{address},
            description = #{description},
            status = #{status}
        WHERE id = #{id}
    </update>

    <update id="updateOrganizationInfo">
        UPDATE sys_organization
        SET name = #{organization.name},
            code = #{organization.code},
            parent_id = #{organization.parentId},
            type = #{organization.type},
            level = #{organization.level},
            sort = #{organization.sort},
            leader = #{organization.leader},
            phone = #{organization.phone},
            email = #{organization.email},
            address = #{organization.address},
            description = #{organization.description},
            status = #{organization.status}
        WHERE id = #{organizationId}
    </update>

    <delete id="deleteById" parameterType="long">
        DELETE FROM sys_organization
        WHERE id = #{id}
    </delete>

</mapper>

